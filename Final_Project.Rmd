---
title: "Final Project"
author: "Lihao Liu, Zikang Chen, Hinn Zhang"
output: 
  html_document:
    toc: true
    toc_float: true
---

## R Markdown

Here we will load all the packages we need for this project.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(skimr)
library(viridis)
library(tidymodels)
```

## Introduction


We define the holiday season to be from Thanksgiving to Christmas, which is from November to December.

## Questions

1. Do people give higher ratings over the years since 2010?
2. Does a movie released during a holiday season tend to receive a lower rating?

## Data

The data set we are going to explore is about Netflix Movies and TV Shows. 

### Data Import

Here we will import the csv file into the studio and take a look at the data set:

```{r}
data <- read_csv("netflix_titles.csv")
movies <- read_csv("n_movies.csv")
glimpse(data)
glimpse(movies)
```

### Data Wrangling

Since the data set we eventually wish to utilize is not two separate tibbles, we need to find a way to extract the useful columns and take the combination of two data sets and conduct our analysis from the integrated tibble.

First, we will merge the two data sets so as to get each movie's rating and votes and also leave only movies with us, since we are not considering TV shows.

```{r}
#filter out only movies
data <- data |> filter(type == "Movie")

#get only the rating and voting columns
movies <- movies[, c("title", "rating", "votes")]

#merge the two data sets
merged <- merge(data, movies, by = "title")
glimpse(merged)
```

Then we want to rename the columns to make their names consistent. 
```{r}
# rename columns
merged <- merged |>
  rename("certificate" = "rating.x",
         "rating" = "rating.y")
```

We also want to change the format of the date column from character to date for easier access.
```{r}
# convert dates from character to date type
merged$date_added <- mdy(merged$date_added)
```

Moreover, we extract the month from the date so that we can generate plots in the EDA section.
```{r}
# create a month column
merged$month <- month(merged$date_added)
```

Since we decide to set the unit of durations of movies into minutes, we can clean the column of Duration into a column of integers.
```{r}
merged$duration <- substring(merged$duration, 1, nchar(merged$duration)-4)
merged$duration <- as.integer(merged$duration)
```

Let's take a look at the wrangled data set.
```{r}
glimpse(merged)
```


## Analysis

### Exploratory Data Analysis

We first want to see when the movies are released in this dataset.
```{r}
merged |>
  ggplot(aes(x = release_year)) +
  geom_bar() +
  labs(x = "Year released",
       y = "Number of movies",
       title = "Most movies released after 2010") +
  theme(text = element_text(size = 15),
        plot.title.position = "plot") +
  theme_minimal() +
  geom_vline(xintercept = 2010, color = "red") +
  annotate("text", x = 2010, y = 250, label = "Year  2010", color = "red", size = 4)
```

We see that most movies are released after 2010, which suggest most movies are contemporary, so we might be able to draw conclusions using our current knowledge.

We also want to see what ratings do movies generally receive.
```{r}
merged |>
  ggplot(aes(x = rating)) +
  geom_bar() +
  labs(x = "Audience ratings",
       y = "Number of movies",
       title = "Most movies receive ratings of 5 - 7") +
  theme(text = element_text(size = 15),
        plot.title.position = "plot") +
  theme_minimal()
```

The plot shows most movies receive a rating in the range of 5 to 7, so we can infer that a rating above 7 tends to be a high rating, while a rating below 5 tends to be a low rating.

We also want to see when movies are added to Netflix in a year.
```{r}
merged |>
  ggplot(aes(x = month)) +
  geom_bar() +
  labs(x = "Month added",
       y = "Number of movies",
       title = "Movies are added all year round to Netflix") +
  scale_x_continuous(breaks = seq(1, 12)) +
  theme(text = element_text(size = 15),
        plot.title.position = "plot") +
  theme_minimal()
```

The visualization shows movies are added to Netflix all year round, and there is a roughly even distribution of movies across all months. Therefore, we can safely carry out our analysis when we compare holiday seasons to non-holiday seasons.

```{r}
merged |>
  filter(month == 11 | month == 12 | month == 1) |>
  ggplot(aes(x = rating)) +
  geom_bar() +
  labs(x = "Audience ratings",
       y = "Number of movies",
       title = "") +
  theme(text = element_text(size = 15),
        plot.title.position = "plot") +
  theme_minimal()
```

```{r}
merged |>
  filter(release_year > 2010) |>
  ggplot(aes(x = month, y = rating)) +
  geom_jitter() +
  geom_smooth(method = "lm")
```


Now we are done with checking the basis of our analysis, we want to gain more information from the data set to have a better understanding of it. One thing really triggered our interests is the relationship between ratings and the lengths of the movies.
```{r}
ggplot(merged, aes(x = rating, y = duration)) +
  geom_point() +
  geom_smooth(method = "lm")+
  labs(x = "Movie Ratings",
       y = "Movie Durations",
       title = "No clear correlation between the duration and the rating of a movie") +
  theme(plot.title.position = "plot") +
  theme_minimal()
```

However, although we anticipated that the ratings of movies that are either too long or too short may receive low ratings, we cannot actually get this conclusion from the plot. There seems to be no correlation between the duration and the rating of a movie just through observing the plot.

We are also curious about the distribution of movie genres across different years. Since there are many years in the data, we are going to take a look at the distributions of the movie genre in three plots, from year 2010 to 2013, 2014 to 2017, and 2018 to 2021 respectively.
```{r}
#create a tibble in longer format with rows for each combination of movie name and movie type from 2010 to 2013
merged_long_10_13 <- merged |>
  filter(release_year >= 2010) |>
  filter(release_year < 2014) |>
  separate_rows(listed_in, sep = ", ") |> 
  group_by(release_year,listed_in) |> 
  summarise(count = n())

#create a tibble in longer format with rows for each combination of movie name and movie type from 2014 to 2017
merged_long_14_17 <- merged |>
  filter(release_year >= 2014) |>
  filter(release_year < 2018) |>
  separate_rows(listed_in, sep = ", ") |> 
  group_by(release_year,listed_in) |> 
  summarise(count = n())

#create a tibble in longer format with rows for each combination of movie name and movie type from 2018 to 2021
merged_long_18_21 <- merged |>
  filter(release_year >= 2018) |>
  filter(release_year < 2022) |>
  separate_rows(listed_in, sep = ", ") |> 
  group_by(release_year,listed_in) |> 
  summarise(count = n())
```

```{r}
#create distribution plot for year 2010-2013
ggplot(merged_long_10_13, aes(x = release_year, y = count, fill = reorder(listed_in, count))) + 
  geom_bar(stat = "identity",
           position = "dodge",
           color = "black") + 
  scale_fill_viridis(discrete = TRUE) +
  labs(x = "Years",
       y = "Count of each movie genre",
       title = "The distributions of movie genres across years") +
  theme_minimal() +
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"),
        plot.title.position = "plot") +
  guides(fill = guide_legend("Movie Genres"))

#create distribution plot for year 2014-2017
ggplot(merged_long_14_17, aes(x = release_year, y = count, fill = reorder(listed_in, count))) + 
  geom_bar(stat = "identity",
           position = "dodge",
           color = "black") + 
  scale_fill_viridis(discrete = TRUE) +
  labs(x = "Years",
       y = "Count of each movie genre",
       title = "The distributions of movie genres across years") +
  theme_minimal() +
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"),
        plot.title.position = "plot") +
  guides(fill = guide_legend("Movie Genres"))

#create distribution plot for year 2018-2021
ggplot(merged_long_18_21, aes(x = release_year, y = count, fill = reorder(listed_in, count))) + 
  geom_bar(stat = "identity",
           position = "dodge",
           color = "black") + 
  scale_fill_viridis(discrete = TRUE) +
  labs(x = "Years",
       y = "Count of each movie genre",
       title = "The distributions of movie genres across years") +
  theme_minimal() +
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"),
        plot.title.position = "plot") +
  guides(fill = guide_legend("Movie Genres"))
```

From the plots we can clearly observe that "International Movies", "Dramas", and "Comedies" appeared the most often from year 2010 to 2021. Can this possibly indicate any trends about the public's movie tastes? Further researches are needed to gain more insights.

### Data Analysis

#### Do people give higher ratings over the years since 2010?

To find out if people give higher ratings over the years since 2010, let's take a look from the plot first to see if there is any clear trend.
```{r}
merged |>
  filter(release_year >= 2010) |>
  ggplot(aes(x = release_year, y = rating)) +
  geom_jitter() +
  geom_smooth(method = "lm") +
  labs(x = "Year released",
       y = "Movie ratings",
       title = "More recent movies received slightly lower ratings") +
  scale_x_continuous(breaks = seq(2010, 2021)) +
  theme(text = element_text(size = 15),
        plot.title.position = "plot") +
  theme_minimal()
```

We see that movies released more recently tend to receive slightly lower ratings than movies released earlier. This might be caused by a change in the public taste of movies, but we are not sure about the exact reasons behind this. 
To be more accurate, let's build a model to see if such decreasing trend exists.
```{r}
recent <- merged |>
  filter(release_year >= 2010)

recent$release_year <- factor(recent$release_year)

linear_reg() |>
  set_engine("lm") |>
  fit(rating ~ release_year, data = recent) |>
  tidy()
```

We can see from the model that, compared to the baseline year 2010, where movies received an average rating of 5.47, people are indeed giving lower ratings, although not significant. People tend to give around 6.63 in 2011 and 6.54 in 2012, but only tend to give 6.15 in 2020 and 5.98 in 2021.

#### Question 2: Does a movie released during a holiday season tend to receive a lower rating?

The mean ratings for movies issued during holiday seasons.
```{r}
recent |>
  filter(month == 11 | month == 12) |>
  summarise(`mean rating` = mean(rating, na.rm = TRUE))
```

The overall mean ratings of all movies.
```{r}
mean(recent$rating, na.rm = TRUE)
```

We see that the average rating is slightly higher for the movies released during the holiday season.

```{r}
recent$month <- factor(recent$month)

glimpse(recent)
```

```{r}
mod <- lm(rating ~ month, data = recent)

tidy(mod)
```
The table shows that the movie ratings in November and December are not significantly different from other months in a year, but we cannot be sure to make this conclusion. Therefore, we will conduct an ANOVA test below to check the difference. Our null hypothesis is that there is no significant difference between the movie ratings made during holiday season and other months.

```{r}
recent <- recent |>
  mutate(is_nov_dec = ifelse(month %in% c(11, 12), "Nov_Dec", "Other_Months"),
         is_nov_dec = factor(is_nov_dec))

# ANOVA model
anova_model <- aov(rating ~ is_nov_dec, data = recent)

# Display model summary
summary(anova_model)
```

Since the p-value is larger than 0.05, we fail to reject the null hypothesis. So there is not a difference between the movie ratings made during holiday season and other months.

### Results


## Conclusion



